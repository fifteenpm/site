<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js canvas - geometry - text</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				margin: 0px;
				overflow: hidden;
			}
		</style>
	</head>
	<body>


		<script src="build/three.js"></script>

		<script src="js/renderers/Projector.js"></script>
		<script src="js/renderers/CanvasRenderer.js"></script>
		<script src="js/SimplexNoise.js"></script>
		<script src="js/GPUComputationRenderer.js"></script>

		<!-- <script src="js/libs/stats.min.js"></script> -->


		<!-- This is the 'compute shader' for the water heightmap: -->
		<script id="heightmapFragmentShader" type="x-shader/x-fragment">

			#include <common>

			uniform vec2 mousePos;
			uniform float mouseSize;
			uniform float viscosityConstant;

			#define deltaTime ( 1.0 / 60.0 )
			#define GRAVITY_CONSTANT ( resolution.x * deltaTime * 3.0 )

			void main()	{

				vec2 cellSize = 1.0 / resolution.xy;

				vec2 uv = gl_FragCoord.xy * cellSize;

				// heightmapValue.x == height
				// heightmapValue.y == velocity
				// heightmapValue.z, heightmapValue.w not used
				vec4 heightmapValue = texture2D( heightmap, uv );

				// Get neighbours
				vec4 north = texture2D( heightmap, uv + vec2( 0.0, cellSize.y ) );
				vec4 south = texture2D( heightmap, uv + vec2( 0.0, - cellSize.y ) );
				vec4 east = texture2D( heightmap, uv + vec2( cellSize.x, 0.0 ) );
				vec4 west = texture2D( heightmap, uv + vec2( - cellSize.x, 0.0 ) );

				float sump = north.x + south.x + east.x + west.x - 4.0 * heightmapValue.x;

				float accel = sump * GRAVITY_CONSTANT;

				// Dynamics
				heightmapValue.y += accel;
				heightmapValue.x += heightmapValue.y * deltaTime;

				// Viscosity
				heightmapValue.x += sump * viscosityConstant;

				// Mouse influence
				float mousePhase = clamp( length( ( uv - vec2( 0.5 ) ) * BOUNDS - vec2( mousePos.x, - mousePos.y ) ) * PI / mouseSize, 0.0, PI );
				heightmapValue.x += cos( mousePhase ) + 1.0;

				gl_FragColor = heightmapValue;

			}

		</script>

		<!-- This is just a smoothing 'compute shader' for using manually: -->
		<script id="smoothFragmentShader" type="x-shader/x-fragment">

			uniform sampler2D texture;

			void main()	{

				vec2 cellSize = 1.0 / resolution.xy;

				vec2 uv = gl_FragCoord.xy * cellSize;

				// Computes the mean of texel and 4 neighbours
				vec4 textureValue = texture2D( texture, uv );
				textureValue += texture2D( texture, uv + vec2( 0.0, cellSize.y ) );
				textureValue += texture2D( texture, uv + vec2( 0.0, - cellSize.y ) );
				textureValue += texture2D( texture, uv + vec2( cellSize.x, 0.0 ) );
				textureValue += texture2D( texture, uv + vec2( - cellSize.x, 0.0 ) );

				textureValue /= 5.0;

				gl_FragColor = textureValue;

			}

		</script>

		<!-- This is the water visualization shader, copied from the MeshPhongMaterial and modified: -->
		<script id="waterVertexShader" type="x-shader/x-vertex">

			uniform sampler2D heightmap;

			#define PHONG

			varying vec3 vViewPosition;

			#ifndef FLAT_SHADED

				varying vec3 vNormal;

			#endif

			#include <common>
			#include <uv_pars_vertex>
			#include <uv2_pars_vertex>
			#include <displacementmap_pars_vertex>
			#include <envmap_pars_vertex>
			#include <color_pars_vertex>
			#include <morphtarget_pars_vertex>
			#include <skinning_pars_vertex>
			#include <shadowmap_pars_vertex>
			#include <logdepthbuf_pars_vertex>
			#include <clipping_planes_pars_vertex>

			void main() {

				vec2 cellSize = vec2( 1.0 / WIDTH, 1.0 / WIDTH );

				#include <uv_vertex>
				#include <uv2_vertex>
				#include <color_vertex>

				// # include <beginnormal_vertex>
				// Compute normal from heightmap
				vec3 objectNormal = vec3(
					( texture2D( heightmap, uv + vec2( - cellSize.x, 0 ) ).x - texture2D( heightmap, uv + vec2( cellSize.x, 0 ) ).x ) * WIDTH / BOUNDS,
					( texture2D( heightmap, uv + vec2( 0, - cellSize.y ) ).x - texture2D( heightmap, uv + vec2( 0, cellSize.y ) ).x ) * WIDTH / BOUNDS,
					1.0 );
				//<beginnormal_vertex>

				#include <morphnormal_vertex>
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#include <defaultnormal_vertex>

			#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED

				vNormal = normalize( transformedNormal );

			#endif

				//# include <begin_vertex>
				float heightValue = texture2D( heightmap, uv ).x;
				vec3 transformed = vec3( position.x, position.y, heightValue );
				//<begin_vertex>

				#include <morphtarget_vertex>
				#include <skinning_vertex>
				#include <displacementmap_vertex>
				#include <project_vertex>
				#include <logdepthbuf_vertex>
				#include <clipping_planes_vertex>

				vViewPosition = - mvPosition.xyz;

				#include <worldpos_vertex>
				#include <envmap_vertex>
				#include <shadowmap_vertex>

			}

		</script>



		<script>

			var inspires = [
			"Maybe She’s Born with It – Thomas Cook, 1984",
			"Betcha Can’t Eat Just One.",
			"Have a Break. Have a Break. Have a Break. Have a Coke and a Smile – Coca Cola, 1979",
			"If you never try, you will be OK.",
			"Just Do It – Thomas Cook, 1984",
			"Be a warrior not a bad day not a bad life.",
			"Don’t call it a dream, call it a dream, call it a dream, call it a dream, call it a plan.",
			"Check if labeled for air conditioner to work harder.",
			"You’re in Good Hands – M&Ms, 1950s",
			"Stay positive, work hard and be nice to people.",
			"Confirm whether an air conditioner and can be adjusted to give you a positive life.",
			"If you can dream it, you can dream it, you can achieve it.",
			"If you have and do what you have curtains or drapes at the window, consider adding a blind or shade.",
			"Have a Break. Have a Break. Have a Coke and a Smile – Coca Cola, 1927",
			"Do the best revenge.",
			"Cats like Felix like Felix like Felix like Felix like Felix like Felix – Felix Cat Food, 1989",
			"Don’t Leave Home Without It – Thomas Cook, 1984",
			"Tastes Great, Less Filling – Miller Beer, 1950",
			"Hey! you can dream it, you can dream it, you can achieve it.",
			"Just Do It – American Express, 1975",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Hands.",
			"Don’t Just Book It, Thomas Cook It – Maybe It’s Maybelline – L’oreal, 1991",
			"Check the load on the Tin – Ronseal, 1994",
			"Keep calm & expect the best & you’ll get it.",
			"Hey! you can dream it, you can raise and lower.",
			"If you can’t make a mistake, you can’t make a mistake, you can’t make anything.",
			"If you can do it!.",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1954",
			"It Is. Are You? – the Us Army, 1981",
			"Melts in Your Hand – M&Ms, 1950s",
			"You are what you have and do what you have and do what you can.",
			"Have a Break. Have a Break. Have a Break. Have a Break. Have a Coke and a Smile – Coca Cola, 1970",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1950s",
			"Let Your Fingers Do the best results.",
			"Have a Break. Have a Break. Have a Break. Have a Coke and a Smile – Coca Cola, 1927",
			"Most units work only in double-hung windows with a lower sash you can dream it, you can do it.",
			"Start where you are, use what you have and do what you have and do what you think you are.",
			"Be a warrior not a bad day not a bad day not a worrier.",
			"A west-facing window could catch enough sun to force the air conditioner fits every type of window.",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1950s",
			"Put a Tiger in Your Mouth, Not in Your Hands.",
			"Don’t call it a plan.",
			"Melts in Your Hands.",
			"Have a Break. Have a Break. Have a Break. Have a Coke and a Smile – Coca Cola, 1970",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1954",
			"It’s just a bad day not a bad day not a bad day not a bad life.",
			"Do the best results.",
			"Not every air conditioner and can be adjusted to give you a positive life.",
			"If you never try, you will never give you a positive life.",
			"Believe in yourself & you will never give you privacy.",
			"You are what you can.",
			"Hey! you can dream it, you can do it.",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Mouth, Not in Your Hands.",
			"Check if labeled for air conditioner and can be adjusted to give you privacy.",
			"Have a Break. Have a Break. Have a Break. Have a Break. Have a Kit Kat. – Rowntree, 1957",
			"Melts in Your Hands – M&Ms, 1954",
			"If you can do it.",
			"Put a Tiger in Your Hands – M&Ms, 1954",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hands.",
			"Be the best results.",
			"Melts in Your Mouth, Not in Your Tank – Esso, 1964",
			"Put a Tiger in Your Hand – M&Ms, 1950s",
			"You can do it!.",
			"If you can dream it, you can dream it, you can do it!.",
			"The Milk Chocolate Melts in Your Hand – M&Ms, 1954",
			"Hey! you can dream it, you can dream it, you can dream it, you can do it!.",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1954",
			"Put a Tiger in Your Hand – M&Ms, 1954",
			"You are what you have and do what you have and do what you have and do what you can.",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hands – M&Ms, 1950s",
			"Melts in Your Hands – Allstate, 1950s",
			"Be the best revenge.",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Tank – Esso, 1964",
			"Keep calm & expect the best version of you.",
			"It’s just a bad day not a bad day not a bad life.",
			"Hey! you can dream it, you can dream it, you can dream it, you can do it.",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hands.",
			"Don’t call it a dream, call it a dream, call it a dream, call it a plan.",
			"Betcha Can't Eat Just One – Packard, 1925",
			"Put a Tiger in Your Hands – M&Ms, 1950s",
			"You’re in Good Hands – M&Ms, 1954",
			"If you can achieve it.",
			"Hey! you can dream it, you can dream it, you can raise and lower.",
			"It’s just a bad day not a bad day not a worrier.",
			"Never let go of your own destiny.",
			"If you can dream it, you can raise and lower.",
			"Be the best you can.",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hands – Allstate, 1950s",
			"Put a Tiger in Your Mouth, Not in Your Hands – Allstate, 1950s",
			"If you have and do what you have and do what you have and do what you can.",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hands – Allstate, 1950s",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Hands – Allstate, 1950s",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Tank – Esso, 1964",
			"The Future’s Bright. The Future’s Bright. The Future’s Bright. The Future’s Orange – Orange, 1994",
			"Success is the best you can.",
			"Don’t Just Book It, Thomas Cook It – American Express, 1975",
			"Hey! you can dream it, you can dream it, you can do it!.",
			"Put a Tiger in Your Mouth, Not in Your Tank – Esso, 1964",
			"Be a warrior not a bad day not a bad day not a bad day not a bad life.",
			"Put a Tiger in Your Mouth, Not in Your Hands – M&Ms, 1954",
			"Confirm whether an air conditioner to work harder.",
			"Let Your Fingers Do the best version of you.",
			"Be a warrior not a bad life.",
			"Most units work only in double-hung windows with a lower sash you can dream it, you can achieve it.",
			"Mmm Mmm Good – KFC, 1952",
			"Let Your Fingers Do the best you can.",
			"Drivers Wanted – Volkswagen, 1959",
			"The Milk Chocolate Melts in Your Tank – Esso, 1964",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1954",
			"It’s just a bad day not a bad day not a bad day not a bad day not a worrier.",
			"If you can dream it, you can dream it, you can dream it, you can raise and lower.",
			"Put a Tiger in Your Hands – Allstate, 1950s",
			"If you never try, you will be unstoppable.",
			"Believe in yourself & you will never know.",
			"The Milk Chocolate Melts in Your Hand – M&Ms, 1950s",
			"Think Small – Volkswagen, 1995",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Mouth, Not in Your Hands – Allstate, 1950s",
			"Maybe She’s Born with It – American Express, 1975",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Hands – M&Ms, 1954",
			"Hey! you can dream it, you can dream it, you can dream it, you can achieve it.",
			"Not every air conditioner use.",
			"If you never try, you will never give you privacy.",
			"Hey! you can dream it, you can do it!.",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Hands – M&Ms, 1950s",
			"Keep calm & expect the best you can.",
			"Also, measure the width and the height of the window where you’ll install your air conditioner.",
			"If you can dream it, you can dream it, you can dream it, you can achieve it.",
			"Be a warrior not a bad day not a bad day not a bad day not a bad day not a bad day not a worrier.",
			"Expect the best you can.",
			"Does Exactly What It Says on the circuit you plan to use.",
			"The Milk Chocolate Melts in Your Hands – Allstate, 1950s",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Hands – M&Ms, 1950s",
			"Don’t Leave Home Without It – Maybe It’s Maybelline – L’oreal, 1991",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Hands – M&Ms, 1954",
			"Confirm whether an air conditioner fits every type of window.",
			"Expect the best results.",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hands – M&Ms, 1954",
			"It’s the Real Thing – Alka Seltzer, 1966",
			"Check if labeled for air conditioner will fit.",
			"Hey! you can dream it, you can dream it, you can dream it, you can raise and lower.",
			"Be a warrior not a bad day not a bad day not a bad day not a bad day not a bad life.",
			"Be a warrior not a bad day not a bad day not a bad life.",
			"If you have and do what you have and do what you can.",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Hands – Allstate, 1950s",
			"The Milk Chocolate Melts in Your Hands – M&Ms, 1954",
			"It’s the Real Thing – Alka Seltzer, 1953",
			"If you have and do what you have and do what you think you are.",
			"These options won’t block the air conditioner fits every type of window.",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Hands.",
			"Have a Break. Have a Break. Have a Break. Have a Kit Kat. – Rowntree, 1957",
			"Cats like Felix like Felix like Felix like Felix – Felix Cat Food, 1989",
			"Betcha Can't Eat Just One – Lays, 1981",
			"Let Your Fingers Do the best & you’ll get it.",
			"Hey! you can achieve it.",
			"Most units work only in double-hung windows with a lower sash you can dream it, you can do it!.",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Mouth, Not in Your Hands – M&Ms, 1950s",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1950s",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Tank – Esso, 1964",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Tank – Esso, 1964",
			"Everything will be unstoppable.",
			"Have a Break. Have a Break. Have a Break. Have a Break. Have a Coke and a Smile – Coca Cola, 1979",
			"Have a Break. Have a Coke and a Smile – Coca Cola, 1970",
			"Put a Tiger in Your Mouth, Not in Your Hand – M&Ms, 1950s",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Tank – Esso, 1964",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1950s",
			"It’s just a bad life.",
			"Start where you are, use what you have and do what you have and do what you can.",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1950s",
			"Don’t Leave Home Without It – Nike, 1988",
			"Maybe She’s Born with It – Nike, 1988",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hands.",
			"Check if labeled for air conditioner and can be adjusted to give you a positive life.",
			"If you can dream it, you can dream it, you can do it.",
			"Not every air conditioner to work harder.",
			"Success is the best results.",
			"Have a Break. Have a Break. Have a Coke and a Smile – Coca Cola, 1970",
			"Check if labeled for air conditioner fits every type of window.",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Mouth, Not in Your Hands.",
			"Melts in Your Mouth, Not in Your Mouth, Not in Your Hand – M&Ms, 1954",
			"Be a warrior not a bad day not a bad day not a bad day not a worrier.",
			"If you can dream it, you can dream it, you can dream it, you can do it.",
			"Start where you are, use what you think you are.",
			"Finger Lickin’ Good – Campbell’s Soup, 1930s",
			"These options won’t block the air conditioner to work harder.",
			"Believe in yourself & you will never give you a positive life.",
			"Don’t call it a dream, call it a dream, call it a plan.",
			"The Milk Chocolate Melts in Your Hands – M&Ms, 1950s",
			"You are what you have and do what you think you are.",
			"If you can’t make anything.",
			"Not every air conditioner will fit.",
			"Hey! you can do it.",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Hands – M&Ms, 1954",
			"If you have and do what you have and do what you have and do what you think you are.",
			"Success is the best & you’ll get it.",
			"Be a warrior not a bad day not a worrier.",
			"If you can dream it, you can dream it, you can raise and lower.",
			"Hey! you can dream it, you can dream it, you can do it.",
			"If you have and do what you think you are.",
			"The Milk Chocolate Melts in Your Mouth, Not in Your Mouth, Not in Your Tank – Esso, 1964",
			"Let Your Fingers Do the best revenge.",
			"Be a warrior not a bad day not a bad day not a bad day not a bad day not a worrier.",
			"Have a Break. Have a Break. Have a Coke and a Smile – Coca Cola, 1979",
			"Expect the best revenge.",
			"Determine the window opening.",
			"You are what you have and do what you have and do what you think you are.",
			"Success is the best version of you.",
			"Have a Break. Have a Coke and a Smile – Coca Cola, 1927",
			"Have a Break. Have a Break. Have a Break. Have a Break. Have a Coke and a Smile – Coca Cola, 1927",
			"It’s just a bad day not a bad day not a bad day not a worrier.",
			"Betcha Can’t Eat Just One – Packard, 1925",
			"If you can dream it, you can dream it, you can dream it, you can dream it, you can achieve it.",
			"Cats like Felix like Felix like Felix like Felix like Felix – Felix Cat Food, 1989",
			"Put a Tiger in Your Mouth, Not in Your Mouth, Not in Your Hands – Allstate, 1950s",
		]

			// Texture width for simulation
			var WIDTH = hash || 128;
			var NUM_TEXELS = WIDTH * WIDTH;

			var hash = document.location.hash.substr( 1 );
			if ( hash ) hash = parseInt( hash, 0 );

			var windowWidth = window.innerWidth;
			var windowHeight = window.innerHeight;
			
			// Water size in system units
			var BOUNDS = windowWidth;//512;
			var BOUNDS_HALF = BOUNDS * 0.5;

			var simplex = new SimplexNoise();

			var container, stats;

			var camera, scene, renderer;

			var fly;
			// var flyPath;
			var flyPath; //TODO rename
			var flyPathObject;
			var textGroup;

			var targetRotation = 0;
			var targetRotationOnMouseDown = 0;

			var mouseX = 0;
			var mouseXOnMouseDown = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			var loader = new THREE.FontLoader();
			loader.load( 'fonts/Exo_Light_Regular.json', function ( font ) {

				init( font );
				animate();

			} );

			function init( font ) {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 90, window.innerWidth / window.innerHeight, 1, 500 );
				camera.position.set( 0, 0, 200 );

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xf0f0f0 );

				// LIGHT

				var dirLight = new THREE.DirectionalLight( 0x0000ff, 1.5 );
				dirLight.position.set( 0, 0, 1 ).normalize();
				scene.add( dirLight );
				
				var pointLight = new THREE.PointLight( 0x00ff00, 1.5 );
				pointLight.position.set( 0, 100, -90 );
				// pointLight.color.setHSL( Math.random(), 1, 0.5 );
				console.log(pointLight);
				pointLight.castShadow = true;
				pointLight.shadow.mapSize.width = 1024; // default is 512
				pointLight.shadow.mapSize.height = 1024; // default is 512
				pointLight.decay = 0;

				scene.add( pointLight );
				// ambientlight
				var ambientLight = new THREE.AmbientLight( 0x404040, 1 );
				scene.add ( ambientLight )

				// // // pointlight
				// var pointLight = new THREE.PointLight( 0x404040, 1000, 800, 2 );
				// pointLight.position.set( 0, 290, 30 );
				// pointLight.castShadow = true;
				// scene.add( pointLight );

				// // pointlight
				// var spotLight = new THREE.SpotLight( 0xffffff );
				// spotLight.position.set( 100, 1000, 100 );

				// spotLight.castShadow = true;

				// spotLight.shadow.mapSize.width = 1024;
				// spotLight.shadow.mapSize.height = 1024;

				// spotLight.shadow.camera.near = 500;
				// spotLight.shadow.camera.far = 4000;
				// spotLight.shadow.camera.fov = 30;

				// scene.add( spotLight );

				// horizon plane
				var geometry = new THREE.BoxGeometry( 10000, 10000, 10 );
				var material = new THREE.MeshPhongMaterial( {color: 0xffffff} );
				var cube = new THREE.Mesh( geometry, material );
				cube.position.set(0, 0, -200);
				cube.rotation.x = 90;
				cube.material.lights = true;
				cube.receiveShadow = true;
				scene.add( cube )


				// // TEXT
				// var theText = "Lorem ipsum";
				//var theText = "Lorem ipsum dolor sit amet consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."
				// var theText = "Lorem ipsum dolor sit amet consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.";
				var theText = inspires[THREE.Math.randInt(0, inspires.length)]
				textGroup = new THREE.Group();
				var lineSize = 10;
				var textPosition = { 
					x: -200, 
					y: 110, 
					z: -10
				};
				var tokensPerLine = 8;
				var tokens = theText.split(" ")
				for(i = 0; i < tokens.length; i += tokensPerLine){
					var textLine = tokens.slice(i, i + tokensPerLine).join(" ")
					var textGeom = new THREE.TextGeometry( textLine, {
						font: font,
						size: 10,
						height: 4,
						curveSegments: 4,
						bevelEnabled: true,
						bevelThickness: 1,
						bevelSize: .1,
						// bevelSegments: 1
					});
					textGeom.computeBoundingBox();
    			textGeom.textWidth = textGeom.boundingBox.max.x - textGeom.boundingBox.min.x;
					var textMaterial = new THREE.MeshLambertMaterial( { color: 0xffffffff } )//0xE45E9D } )
					var textMesh = new THREE.Mesh( textGeom, textMaterial );
					textMesh.castShadow = true;
					textMesh.position.set( textPosition.x, textPosition.y, textPosition.z );
					// textMesh.rotation.x = Math.PI / 4 ;
					// textMesh.rotation.y = Math.PI  / 4;
					textGroup.add( textMesh );
					// scene.add( textMesh );
					textPosition.y -= lineSize * 2;
				}
				scene.add( textGroup );
				
				renderer = new THREE.WebGLRenderer();//{alpha:true,  antialias: true});
				renderer.shadowMap.enabled = true;
				renderer.shadowMap.type = THREE.PCFSoftShadowMap; 
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );

				// stats = new Stats();
				// container.appendChild( stats.dom );

				document.addEventListener( 'mousedown', onDocumentMouseDown, false );
				document.addEventListener( 'touchstart', onDocumentTouchStart, false );
				document.addEventListener( 'touchmove', onDocumentTouchMove, false );

				initFly();
				// window.addEventListener( 'resize', onWindowResize, false );
				// initWater();
				// new flight path every n seconds
				setInterval(function () {
            updateFlyPath();
      	}, 5000);
			}

			function generateFlyPath() {
				var flyPathVertices = []
				var numFlyPathVertices = 20;
				var numFlyPathPoints = 200;
				var maxX = 250;
				var minX = -250;
				var maxY = 50;
				var minY = 0;
				var maxZ = 350;
				var minZ = -250;
				for (i = 0; i < numFlyPathVertices; i ++){
					if(i == 0) { 
						// if (fly !== undefined && flyPath !== undefined){
						// 	//var end = flyPath.points.length - 1
						// 	console.log("RESET")
						// 	flyPathVertices.push(new THREE.Vector3(maxX, maxY, maxZ))
						// 	//flyPathVertices.push(new THREE.Vector3(flyPath.points[end].x, flyPath.points[end].y, flyPath.points[end].z));
						// } else {
							// ensure fly starts at min
						flyPathVertices.push(new THREE.Vector3(minX, minY, minZ));
						// }
					} else if (i == numFlyPathVertices / 2){
						// ensure fly paths center
						flyPathVertices.push(new THREE.Vector3(0, 0, 0));
					} else if (i == numFlyPathVertices - 1){
						// ensure fly loop ends at max
						flyPathVertices.push(new THREE.Vector3(maxX, maxY, maxZ));
					} else {
						var randVect3 = new THREE.Vector3(
							THREE.Math.randInt(minX, maxX),
							THREE.Math.randInt(minY, maxY),
							THREE.Math.randInt(minZ, maxZ)
						);
						flyPathVertices.push(randVect3)
					}
				}
				flyPath = new THREE.CatmullRomCurve3(flyPathVertices);
				var flyPathPoints = flyPath.getPoints( numFlyPathPoints );
				var flyPathGeom = new THREE.BufferGeometry().setFromPoints( flyPathPoints );
				var flyPathMaterial = new THREE.LineBasicMaterial( { color : 0x000000, transparent: true } );
				flyPathMaterial.opacity = 0;
				if (flyPathObject !== undefined) {
					scene.remove(flyPathObject);
				}
				flyPathObject = new THREE.Line( flyPathGeom, flyPathMaterial );
				scene.add (flyPathObject);
			}

			function initFly() {
				//Create a closed wavey loop
				generateFlyPath()
				
				// fly sound
				// create an AudioListener and add it to the camera
				var listener = new THREE.AudioListener();
				camera.add( listener );
				// create the PositionalAudio object (passing in the listener)
				var sound = new THREE.PositionalAudio( listener );
				// load a sound and set it as the PositionalAudio object's buffer
				sound.loop = true;
				var audioLoader = new THREE.AudioLoader();
				audioLoader.load( 'assets/fly.wav', function( buffer ) {
					sound.setBuffer( buffer );
					// sound.setLoop( true );
					sound.setRefDistance( 20 );
					sound.setVolume(.2);
					sound.play();
				});
				
				
				// fly
				var flyGeom = new THREE.BoxGeometry( 1, 1, 1 );
				var flyMaterial = new THREE.MeshPhongMaterial( {color: 0x000000} );
				fly = new THREE.Mesh( flyGeom, flyMaterial );
				fly.position.set(0, 0, -200);
				fly.rotation.x = 90;
				fly.material.lights = true;
				fly.position.set(flyPath.points[0].x, flyPath.points[0].y, flyPath.points[0].z);
				fly.castShadow = true;
				fly.add( sound );
				scene.add( fly );
			}

			function updateFlyPath() {
				generateFlyPath();
			}


			function initWater() {

				// var materialColor = 0x4d88ff;
				var materialColor = 0xc0c0c0;

				var geometry = new THREE.PlaneBufferGeometry( BOUNDS, BOUNDS, WIDTH - 1, WIDTH -1 );

				// material: make a ShaderMaterial clone of MeshPhongMaterial, with customized vertex shader
				var material = new THREE.ShaderMaterial( {
					uniforms: THREE.UniformsUtils.merge( [
						THREE.ShaderLib[ 'phong' ].uniforms,
						{
							heightmap: { value: null }
						}
					] ),
					vertexShader: document.getElementById( 'waterVertexShader' ).textContent,
					fragmentShader: THREE.ShaderChunk[ 'meshphong_frag' ],
					transparent: true
				} );

				material.lights = true;

				// Material attributes from MeshPhongMaterial
				material.color = new THREE.Color( materialColor );
				material.specular = new THREE.Color( 0xFFFFF );
				// material.specular = new THREE.Color( 0x111111 );
				material.shininess = 10;
				// material.clipShadows = true;

				// Sets the uniforms with the material values
				material.uniforms.diffuse.value = material.color;
				material.uniforms.specular.value = material.specular;
				material.uniforms.shininess.value = Math.max( material.shininess, 1e-4 );
				
				//material.uniforms.transparency = true;
				material.uniforms.opacity.value = 0.2;//material.opacity;
				
				// Defines
				material.defines.WIDTH = WIDTH.toFixed( 1 );
				material.defines.BOUNDS = BOUNDS.toFixed( 1 );

				waterUniforms = material.uniforms;

				waterMesh = new THREE.Mesh( geometry, material );
				// waterMesh.rotation.x = -1;
				// waterMesh.rotation.y = - Math.PI / 2;
				waterMesh.position.set(0, 0, 0);
				waterMesh.matrixAutoUpdate = false;
				// waterMesh.castShadow = true;
				waterMesh.updateMatrix();
				scene.add( waterMesh );

				// Mesh just for mouse raycasting
				var geometryRay = new THREE.PlaneBufferGeometry( BOUNDS, BOUNDS, 1, 1 );
				meshRay = new THREE.Mesh( geometryRay, new THREE.MeshBasicMaterial( { color: 0xFFFFFF, visible: false } ) );
				meshRay.rotation.x = - Math.PI / 2;
				meshRay.matrixAutoUpdate = false;
				meshRay.updateMatrix();
				scene.add( meshRay );


				// Creates the gpu computation class and sets it up

				gpuCompute = new GPUComputationRenderer( WIDTH, WIDTH, renderer );

				var heightmap0 = gpuCompute.createTexture();

				fillTexture( heightmap0 );

				heightmapVariable = gpuCompute.addVariable( "heightmap", document.getElementById( 'heightmapFragmentShader' ).textContent, heightmap0 );

				gpuCompute.setVariableDependencies( heightmapVariable, [ heightmapVariable ] );

				heightmapVariable.material.uniforms.mousePos = { value: new THREE.Vector2( 10000, 10000 ) };
				heightmapVariable.material.uniforms.mouseSize = { value: 20.0 };
				heightmapVariable.material.uniforms.viscosityConstant = { value: 0.03 };
				heightmapVariable.material.defines.BOUNDS = BOUNDS.toFixed( 1 );

				var error = gpuCompute.init();
				if ( error !== null ) {
				    console.error( error );
				}

				// Create compute shader to smooth the water surface and velocity
				smoothShader = gpuCompute.createShaderMaterial( document.getElementById( 'smoothFragmentShader' ).textContent, { texture: { value: null } } );

			}

			function fillTexture( texture ) {

				var waterMaxHeight = 10;

				function noise( x, y, z ) {
					var multR = waterMaxHeight;
					var mult = 0.025;
					var r = 0;
					for ( var i = 0; i < 15; i++ ) {
						r += multR * simplex.noise( x * mult, y * mult );
						multR *= 0.53 + 0.025 * i;
						mult *= 1.25;
					}
					return r;
				}

				var pixels = texture.image.data;

				var p = 0;
				for ( var j = 0; j < WIDTH; j++ ) {
					for ( var i = 0; i < WIDTH; i++ ) {

						var x = i * 128 / WIDTH;
						var y = j * 128 / WIDTH;

					        pixels[ p + 0 ] = noise( x, y, 123.4 );
						pixels[ p + 1 ] = 0;
						pixels[ p + 2 ] = 0;
						pixels[ p + 3 ] = 1;

						p += 4;
					}
				}

			}


			function onWindowResize() {

				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			//

			function onDocumentMouseDown( event ) {

				event.preventDefault();

				document.addEventListener( 'mousemove', onDocumentMouseMove, false );
				document.addEventListener( 'mouseup', onDocumentMouseUp, false );
				document.addEventListener( 'mouseout', onDocumentMouseOut, false );

				mouseXOnMouseDown = event.clientX - windowHalfX;
				targetRotationOnMouseDown = targetRotation;

			}

			function onDocumentMouseMove( event ) {

				mouseX = event.clientX - windowHalfX;

				targetRotation = targetRotationOnMouseDown + ( mouseX - mouseXOnMouseDown ) * 0.02;

			}

			function onDocumentMouseUp( event ) {

				document.removeEventListener( 'mousemove', onDocumentMouseMove, false );
				document.removeEventListener( 'mouseup', onDocumentMouseUp, false );
				document.removeEventListener( 'mouseout', onDocumentMouseOut, false );

			}

			function onDocumentMouseOut( event ) {

				document.removeEventListener( 'mousemove', onDocumentMouseMove, false );
				document.removeEventListener( 'mouseup', onDocumentMouseUp, false );
				document.removeEventListener( 'mouseout', onDocumentMouseOut, false );

			}

			function onDocumentTouchStart( event ) {

				if ( event.touches.length == 1 ) {

					event.preventDefault();

					mouseXOnMouseDown = event.touches[ 0 ].pageX - windowHalfX;
					targetRotationOnMouseDown = targetRotation;

				}

			}

			function onDocumentTouchMove( event ) {

				if ( event.touches.length == 1 ) {

					event.preventDefault();

					mouseX = event.touches[ 0 ].pageX - windowHalfX;
					targetRotation = targetRotationOnMouseDown + ( mouseX - mouseXOnMouseDown ) * 0.05;

				}

			}

			//

			function animate() {

				requestAnimationFrame( animate );
				render();
				// stats.update();
			}

			var t = 0;

			function render() {

				// Set uniforms: mouse interaction
				// var uniforms = heightmapVariable.material.uniforms;

				t += 0.001;
				var pos = flyPath.getPoint(t);
				fly.position.set(pos.x, pos.y, pos.z);

				//fly.position.set()
				// if ( mouseMoved ) {

				// 	this.raycaster.setFromCamera( mouseCoords, camera );

				// 	var intersects = this.raycaster.intersectObject( meshRay );

				// 	if ( intersects.length > 0 ) {
				// 	    var point = intersects[ 0 ].point;
				// 	    uniforms.mousePos.value.set( point.x, point.z );

				// 	}
				// 	else {
				// 	    uniforms.mousePos.value.set( 10000, 10000 );
				// 	}

				// 	mouseMoved = false;
				// }
				// else {
				// 	uniforms.mousePos.value.set( 10000, 10000 );
				// }

				// Do the gpu computation
				// gpuCompute.compute();

				// Get compute output in custom uniform
				// waterUniforms.heightmap.value = gpuCompute.getCurrentRenderTarget( heightmapVariable ).texture;

				
				// textGroup.rotation.y += ( targetRotation - textGroup.rotation.y ) * 0.05;
				renderer.render( scene, camera );
			}

		</script>

	</body>
</html>
